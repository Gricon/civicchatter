<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Civic Chatter</title>

  <link rel="stylesheet" href="styles.css" />

  <!-- PWA (optional) -->
  <link rel="manifest" href="/manifest.webmanifest" />
  <meta name="theme-color" content="#002868" />
  <script>
    if ("serviceWorker" in navigator) {
      window.addEventListener("load", () =>
        navigator.serviceWorker.register("/sw.js").catch(() => {})
      );
    }
  </script>

  <!-- Load Supabase before app.js; defer preserves order -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2" defer></script>
  <script src="app.js" defer></script>

  <style>
    /* tiny in-page debug console */
    #cc-debug {
      position: fixed; bottom: 8px; left: 8px; right: 8px;
      max-height: 35vh; overflow:auto; background: #0f172a; color:#e5e7eb;
      font: 12px/1.35 ui-monospace, SFMono-Regular, Menlo, monospace;
      padding: .5rem .75rem; border-radius: 10px; box-shadow: 0 2px 12px rgba(0,0,0,.35);
      display: none; z-index: 9999;
    }
    #cc-debug b { color:#93c5fd; }
    #cc-debug .ok { color:#86efac; }
    #cc-debug .err { color:#fca5a5; }
    #cc-debug .muted { color:#94a3b8; }
    #cc-debug .row { display:flex; gap:.5rem; align-items:center; margin-bottom:.25rem;}
    #cc-debug .btn { padding:.25rem .5rem; border-radius:6px; border:1px solid #334155; background:#1f2937; color:#e5e7eb; cursor:pointer;}
    #cc-debug .btn:hover { background:#111827; }
  </style>
</head>
<body>
  <a class="skip-link" href="#main">Skip to content</a>

  <header>
    <h1>Civic Chatter</h1>
    <nav id="nav" class="hidden">
      <a href="#/profile" class="nav-link">My Profile</a>
      <a href="#/d/me" class="nav-link" id="my-debate-link">My Debate</a>
      <a href="#/login" class="nav-link" id="logout-link">Logout</a>
    </nav>
  </header>

  <main id="main" class="container">

    <!-- LOGIN -->
    <section id="login-section" class="card">
      <h2 class="mt-0">Sign in</h2>
      <p class="hint">Use your <b>handle</b> or <b>email</b> and password.</p>

      <label>Username or Email
        <input id="login-username" type="text" autocomplete="username" placeholder="yourhandle or you@example.com" />
      </label>
      <label>Password
        <input id="login-password" type="password" autocomplete="current-password" placeholder="••••••••" />
      </label>

      <div class="row">
        <!-- inline fallback onclicks as a safety net -->
        <button id="btn-login" type="button" class="button--primary"
                onclick="window.__onLogin && window.__onLogin(event)">Sign In</button>
        <button id="go-signup" type="button" class="button--ghost"
                onclick="location.hash='#/signup'">Create account</button>
      </div>
    </section>

    <!-- SIGNUP -->
    <section id="signup-section" class="card hidden">
      <h2 class="mt-0">Create account</h2>
      <div class="grid">
        <label>Name
          <input id="signup-name" type="text" placeholder="Your name" />
        </label>
        <label>Handle (public @username)
          <input id="signup-handle" type="text" placeholder="e.g. conrad" />
          <small class="hint">3+ chars: a–z, 0–9, _ or -</small>
        </label>
        <label>Email
          <input id="signup-email" type="email" autocomplete="email" placeholder="you@example.com" />
        </label>
        <label>Phone (optional)
          <input id="signup-phone" type="tel" placeholder="+63..." />
        </label>
        <label>Password
          <input id="signup-password" type="password" autocomplete="new-password" placeholder="Create a password" />
        </label>
        <label>Address (optional)
          <input id="signup-address" type="text" placeholder="Address" />
        </label>
      </div>
      <label class="row" style="margin-top:.25rem">
        <input id="signup-private" type="checkbox" /> Private account (not searchable)
      </label>

      <div class="row">
        <button id="btn-signup" type="button" class="button--primary"
                onclick="window.__onSignup && window.__onSignup(event)">Create Account</button>
        <button id="go-login" type="button" class="button--ghost"
                onclick="location.hash='#/login'">Back to login</button>
      </div>
    </section>

    <!-- PRIVATE PROFILE (owner-only) -->
    <section class="card hidden" id="private-profile">
      <h2 class="mt-0">My Private Profile</h2>
      <div class="grid">
        <label>Handle (public URL)
          <input type="text" id="pp-handle" placeholder="e.g. conrad" />
        </label>
        <label>Display Name
          <input type="text" id="pp-display-name" placeholder="e.g. Conrad G." />
        </label>
        <label>Bio
          <textarea id="pp-bio" placeholder="Short bio"></textarea>
        </label>
        <label>City
          <input type="text" id="pp-city" placeholder="e.g. Manila" />
        </label>
        <label>Avatar URL
          <input type="url" id="pp-avatar-url" placeholder="https://..." />
        </label>
      </div>

      <h3>Private Details (not public)</h3>
      <div class="grid">
        <label>Email
          <input type="email" id="pr-email" placeholder="user@example.com" />
        </label>
        <label>Phone
          <input type="tel" id="pr-phone" placeholder="+63..." />
        </label>
      </div>

      <div class="row">
        <button id="save-profile" type="button"
                onclick="window.__onSaveProfile && window.__onSaveProfile(event)">Save Profile</button>
        <a id="public-link" class="link" href="#">View Public Page</a>
      </div>
    </section>

    <!-- PUBLIC PROFILE (read-only) -->
    <section class="card hidden" id="public-profile">
      <div class="public-header">
        <img id="pub-avatar" alt="avatar" class="avatar" />
        <div>
          <h2 id="pub-display-name" class="mt-0 mb-0"></h2>
          <p class="handle" id="pub-handle"></p>
          <p class="city" id="pub-city"></p>
        </div>
      </div>
      <p id="pub-bio"></p>
    </section>

    <!-- DEBATE PAGE -->
    <section class="card hidden" id="debate-page">
      <h2 id="deb-title" class="mt-0">Debates</h2>
      <p id="deb-desc" class="hint"></p>
      <div id="deb-content" style="margin-top:1rem;"></div>
    </section>

  </main>

  <!-- Minimal in-page debug console -->
  <div id="cc-debug">
    <div class="row">
      <button class="btn" onclick="this.parentNode.parentNode.style.display='none'">Hide</button>
      <button class="btn" onclick="window.__ccClearDebug()">Clear</button>
      <button class="btn" onclick="window.__ccSelfTest()">Self-test</button>
      <span class="muted">Tip: go to <b>#/debug</b> to auto-open</span>
    </div>
    <div id="cc-debug-log"></div>
  </div>
</body>
</html>
